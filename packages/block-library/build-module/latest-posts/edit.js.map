{"version":3,"sources":["/Users/ky/Sites/valet/copesacontent/web/app/plugins/gutenberg/packages/block-library/src/latest-posts/edit.js"],"names":["isUndefined","pickBy","classnames","Component","Fragment","PanelBody","Placeholder","QueryControls","RangeControl","Spinner","ToggleControl","Toolbar","__","dateI18n","format","__experimentalGetSettings","decodeEntities","InspectorControls","BlockAlignmentToolbar","BlockControls","withSelect","MAX_POSTS_COLUMNS","LatestPostsEdit","arguments","toggleDisplayPostDate","bind","displayPostDate","props","attributes","setAttributes","categoriesList","latestPosts","align","postLayout","columns","order","orderBy","categories","postsToShow","inspectorControls","value","undefined","hasPosts","Math","min","length","Array","isArray","displayPosts","slice","layoutControls","icon","title","onClick","isActive","dateFormat","formats","date","nextAlign","className","map","post","i","link","rendered","trim","date_gmt","select","getEntityRecords","latestPostsQuery","orderby","per_page","categoriesListQuery"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { isUndefined, pickBy } from 'lodash';\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { Component, Fragment } from '@wordpress/element';\nimport {\n\tPanelBody,\n\tPlaceholder,\n\tQueryControls,\n\tRangeControl,\n\tSpinner,\n\tToggleControl,\n\tToolbar,\n} from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\nimport { dateI18n, format, __experimentalGetSettings } from '@wordpress/date';\nimport { decodeEntities } from '@wordpress/html-entities';\nimport {\n\tInspectorControls,\n\tBlockAlignmentToolbar,\n\tBlockControls,\n} from '@wordpress/editor';\nimport { withSelect } from '@wordpress/data';\n\nconst MAX_POSTS_COLUMNS = 6;\n\nclass LatestPostsEdit extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.toggleDisplayPostDate = this.toggleDisplayPostDate.bind( this );\n\t}\n\n\ttoggleDisplayPostDate() {\n\t\tconst { displayPostDate } = this.props.attributes;\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { displayPostDate: ! displayPostDate } );\n\t}\n\n\trender() {\n\t\tconst { attributes, categoriesList, setAttributes, latestPosts } = this.props;\n\t\tconst { displayPostDate, align, postLayout, columns, order, orderBy, categories, postsToShow } = attributes;\n\n\t\tconst inspectorControls = (\n\t\t\t<InspectorControls>\n\t\t\t\t<PanelBody title={ __( 'Latest Posts Settings' ) }>\n\t\t\t\t\t<QueryControls\n\t\t\t\t\t\t{ ...{ order, orderBy } }\n\t\t\t\t\t\tnumberOfItems={ postsToShow }\n\t\t\t\t\t\tcategoriesList={ categoriesList }\n\t\t\t\t\t\tselectedCategoryId={ categories }\n\t\t\t\t\t\tonOrderChange={ ( value ) => setAttributes( { order: value } ) }\n\t\t\t\t\t\tonOrderByChange={ ( value ) => setAttributes( { orderBy: value } ) }\n\t\t\t\t\t\tonCategoryChange={ ( value ) => setAttributes( { categories: '' !== value ? value : undefined } ) }\n\t\t\t\t\t\tonNumberOfItemsChange={ ( value ) => setAttributes( { postsToShow: value } ) }\n\t\t\t\t\t/>\n\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\tlabel={ __( 'Display post date' ) }\n\t\t\t\t\t\tchecked={ displayPostDate }\n\t\t\t\t\t\tonChange={ this.toggleDisplayPostDate }\n\t\t\t\t\t/>\n\t\t\t\t\t{ postLayout === 'grid' &&\n\t\t\t\t\t\t<RangeControl\n\t\t\t\t\t\t\tlabel={ __( 'Columns' ) }\n\t\t\t\t\t\t\tvalue={ columns }\n\t\t\t\t\t\t\tonChange={ ( value ) => setAttributes( { columns: value } ) }\n\t\t\t\t\t\t\tmin={ 2 }\n\t\t\t\t\t\t\tmax={ ! hasPosts ? MAX_POSTS_COLUMNS : Math.min( MAX_POSTS_COLUMNS, latestPosts.length ) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t}\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\t\t);\n\n\t\tconst hasPosts = Array.isArray( latestPosts ) && latestPosts.length;\n\t\tif ( ! hasPosts ) {\n\t\t\treturn (\n\t\t\t\t<Fragment>\n\t\t\t\t\t{ inspectorControls }\n\t\t\t\t\t<Placeholder\n\t\t\t\t\t\ticon=\"admin-post\"\n\t\t\t\t\t\tlabel={ __( 'Latest Posts' ) }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ ! Array.isArray( latestPosts ) ?\n\t\t\t\t\t\t\t<Spinner /> :\n\t\t\t\t\t\t\t__( 'No posts found.' )\n\t\t\t\t\t\t}\n\t\t\t\t\t</Placeholder>\n\t\t\t\t</Fragment>\n\t\t\t);\n\t\t}\n\n\t\t// Removing posts from display should be instant.\n\t\tconst displayPosts = latestPosts.length > postsToShow ?\n\t\t\tlatestPosts.slice( 0, postsToShow ) :\n\t\t\tlatestPosts;\n\n\t\tconst layoutControls = [\n\t\t\t{\n\t\t\t\ticon: 'list-view',\n\t\t\t\ttitle: __( 'List View' ),\n\t\t\t\tonClick: () => setAttributes( { postLayout: 'list' } ),\n\t\t\t\tisActive: postLayout === 'list',\n\t\t\t},\n\t\t\t{\n\t\t\t\ticon: 'grid-view',\n\t\t\t\ttitle: __( 'Grid View' ),\n\t\t\t\tonClick: () => setAttributes( { postLayout: 'grid' } ),\n\t\t\t\tisActive: postLayout === 'grid',\n\t\t\t},\n\t\t];\n\n\t\tconst dateFormat = __experimentalGetSettings().formats.date;\n\n\t\treturn (\n\t\t\t<Fragment>\n\t\t\t\t{ inspectorControls }\n\t\t\t\t<BlockControls>\n\t\t\t\t\t<BlockAlignmentToolbar\n\t\t\t\t\t\tvalue={ align }\n\t\t\t\t\t\tonChange={ ( nextAlign ) => {\n\t\t\t\t\t\t\tsetAttributes( { align: nextAlign } );\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tcontrols={ [ 'center', 'wide', 'full' ] }\n\t\t\t\t\t/>\n\t\t\t\t\t<Toolbar controls={ layoutControls } />\n\t\t\t\t</BlockControls>\n\t\t\t\t<ul\n\t\t\t\t\tclassName={ classnames( this.props.className, {\n\t\t\t\t\t\t'is-grid': postLayout === 'grid',\n\t\t\t\t\t\t'has-dates': displayPostDate,\n\t\t\t\t\t\t[ `columns-${ columns }` ]: postLayout === 'grid',\n\t\t\t\t\t} ) }\n\t\t\t\t>\n\t\t\t\t\t{ displayPosts.map( ( post, i ) =>\n\t\t\t\t\t\t<li key={ i }>\n\t\t\t\t\t\t\t<a href={ post.link } target=\"_blank\">{ decodeEntities( post.title.rendered.trim() ) || __( '(Untitled)' ) }</a>\n\t\t\t\t\t\t\t{ displayPostDate && post.date_gmt &&\n\t\t\t\t\t\t\t\t<time dateTime={ format( 'c', post.date_gmt ) } className={ `${ this.props.className }__post-date` }>\n\t\t\t\t\t\t\t\t\t{ dateI18n( dateFormat, post.date_gmt ) }\n\t\t\t\t\t\t\t\t</time>\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t</li>\n\t\t\t\t\t) }\n\t\t\t\t</ul>\n\t\t\t</Fragment>\n\t\t);\n\t}\n}\n\nexport default withSelect( ( select, props ) => {\n\tconst { postsToShow, order, orderBy, categories } = props.attributes;\n\tconst { getEntityRecords } = select( 'core' );\n\tconst latestPostsQuery = pickBy( {\n\t\tcategories,\n\t\torder,\n\t\torderby: orderBy,\n\t\tper_page: postsToShow,\n\t}, ( value ) => ! isUndefined( value ) );\n\tconst categoriesListQuery = {\n\t\tper_page: 100,\n\t};\n\treturn {\n\t\tlatestPosts: getEntityRecords( 'postType', 'post', latestPostsQuery ),\n\t\tcategoriesList: getEntityRecords( 'taxonomy', 'category', categoriesListQuery ),\n\t};\n} )( LatestPostsEdit );\n"]}