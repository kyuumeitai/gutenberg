{"version":3,"sources":["/Users/ky/Sites/valet/copesacontent/web/app/plugins/gutenberg/packages/editor/src/components/block-list/index.js"],"names":["BlockList","props","onSelectionStart","bind","onSelectionEnd","onShiftSelection","setBlockRef","setLastClientY","onPointerMove","onScroll","clientY","lastClientY","nodes","window","addEventListener","removeEventListener","node","clientId","isMultiSelecting","onStartMultiSelect","boundaries","selectionAtStart","getBoundingClientRect","y","top","key","coordMapKeys","coordY","onSelectionChange","coordMap","isSelectionEnabled","clientIdToCoordMap","Object","values","onMultiSelect","selectionStart","selectionEnd","isAtStart","cancel","onStopMultiSelect","selectionStartClientId","onSelect","blockClientIds","rootClientId","isDraggable","blockIndex","length","Component","select","ownProps","getBlockOrder","getMultiSelectedBlocksStartClientId","getMultiSelectedBlocksEndClientId","getBlockSelectionStart","dispatch","startMultiSelect","stopMultiSelect","multiSelect","selectBlock"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport {\n\tfindLast,\n\tmap,\n\tinvert,\n\tmapValues,\n\tsortBy,\n\tthrottle,\n} from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { withSelect, withDispatch } from '@wordpress/data';\nimport { compose } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport BlockListBlock from './block';\nimport BlockListAppender from '../block-list-appender';\n\nclass BlockList extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\n\t\tthis.onSelectionStart = this.onSelectionStart.bind( this );\n\t\tthis.onSelectionEnd = this.onSelectionEnd.bind( this );\n\t\tthis.onShiftSelection = this.onShiftSelection.bind( this );\n\t\tthis.setBlockRef = this.setBlockRef.bind( this );\n\t\tthis.setLastClientY = this.setLastClientY.bind( this );\n\t\tthis.onPointerMove = throttle( this.onPointerMove.bind( this ), 100 );\n\t\t// Browser does not fire `*move` event when the pointer position changes\n\t\t// relative to the document, so fire it with the last known position.\n\t\tthis.onScroll = () => this.onPointerMove( { clientY: this.lastClientY } );\n\n\t\tthis.lastClientY = 0;\n\t\tthis.nodes = {};\n\t}\n\n\tcomponentDidMount() {\n\t\twindow.addEventListener( 'mousemove', this.setLastClientY );\n\t}\n\n\tcomponentWillUnmount() {\n\t\twindow.removeEventListener( 'mousemove', this.setLastClientY );\n\t}\n\n\tsetLastClientY( { clientY } ) {\n\t\tthis.lastClientY = clientY;\n\t}\n\n\tsetBlockRef( node, clientId ) {\n\t\tif ( node === null ) {\n\t\t\tdelete this.nodes[ clientId ];\n\t\t} else {\n\t\t\tthis.nodes = {\n\t\t\t\t...this.nodes,\n\t\t\t\t[ clientId ]: node,\n\t\t\t};\n\t\t}\n\t}\n\n\t/**\n\t * Handles a pointer move event to update the extent of the current cursor\n\t * multi-selection.\n\t *\n\t * @param {MouseEvent} event A mousemove event object.\n\t *\n\t * @return {void}\n\t */\n\tonPointerMove( { clientY } ) {\n\t\t// We don't start multi-selection until the mouse starts moving, so as\n\t\t// to avoid dispatching multi-selection actions on an in-place click.\n\t\tif ( ! this.props.isMultiSelecting ) {\n\t\t\tthis.props.onStartMultiSelect();\n\t\t}\n\n\t\tconst boundaries = this.nodes[ this.selectionAtStart ].getBoundingClientRect();\n\t\tconst y = clientY - boundaries.top;\n\t\tconst key = findLast( this.coordMapKeys, ( coordY ) => coordY < y );\n\n\t\tthis.onSelectionChange( this.coordMap[ key ] );\n\t}\n\n\t/**\n\t * Binds event handlers to the document for tracking a pending multi-select\n\t * in response to a mousedown event occurring in a rendered block.\n\t *\n\t * @param {string} clientId Client ID of block where mousedown occurred.\n\t *\n\t * @return {void}\n\t */\n\tonSelectionStart( clientId ) {\n\t\tif ( ! this.props.isSelectionEnabled ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst boundaries = this.nodes[ clientId ].getBoundingClientRect();\n\n\t\t// Create a clientId to Y coördinate map.\n\t\tconst clientIdToCoordMap = mapValues( this.nodes, ( node ) =>\n\t\t\tnode.getBoundingClientRect().top - boundaries.top );\n\n\t\t// Cache a Y coördinate to clientId map for use in `onPointerMove`.\n\t\tthis.coordMap = invert( clientIdToCoordMap );\n\t\t// Cache an array of the Y coördinates for use in `onPointerMove`.\n\t\t// Sort the coördinates, as `this.nodes` will not necessarily reflect\n\t\t// the current block sequence.\n\t\tthis.coordMapKeys = sortBy( Object.values( clientIdToCoordMap ) );\n\t\tthis.selectionAtStart = clientId;\n\n\t\twindow.addEventListener( 'mousemove', this.onPointerMove );\n\t\t// Capture scroll on all elements.\n\t\twindow.addEventListener( 'scroll', this.onScroll, true );\n\t\twindow.addEventListener( 'mouseup', this.onSelectionEnd );\n\t}\n\n\t/**\n\t * Handles multi-selection changes in response to pointer move.\n\t *\n\t * @param {string} clientId Client ID of block under cursor in multi-select\n\t *                          drag.\n\t */\n\tonSelectionChange( clientId ) {\n\t\tconst { onMultiSelect, selectionStart, selectionEnd } = this.props;\n\t\tconst { selectionAtStart } = this;\n\t\tconst isAtStart = selectionAtStart === clientId;\n\n\t\tif ( ! selectionAtStart || ! this.props.isSelectionEnabled ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If multi-selecting and cursor extent returns to the start of\n\t\t// selection, cancel multi-select.\n\t\tif ( isAtStart && selectionStart ) {\n\t\t\tonMultiSelect( null, null );\n\t\t}\n\n\t\t// Expand multi-selection to block under cursor.\n\t\tif ( ! isAtStart && selectionEnd !== clientId ) {\n\t\t\tonMultiSelect( selectionAtStart, clientId );\n\t\t}\n\t}\n\n\t/**\n\t * Handles a mouseup event to end the current cursor multi-selection.\n\t *\n\t * @return {void}\n\t */\n\tonSelectionEnd() {\n\t\t// Cancel throttled calls.\n\t\tthis.onPointerMove.cancel();\n\n\t\tdelete this.coordMap;\n\t\tdelete this.coordMapKeys;\n\t\tdelete this.selectionAtStart;\n\n\t\twindow.removeEventListener( 'mousemove', this.onPointerMove );\n\t\twindow.removeEventListener( 'scroll', this.onScroll, true );\n\t\twindow.removeEventListener( 'mouseup', this.onSelectionEnd );\n\n\t\t// We may or may not be in a multi-selection when mouseup occurs (e.g.\n\t\t// an in-place mouse click), so only trigger stop if multi-selecting.\n\t\tif ( this.props.isMultiSelecting ) {\n\t\t\tthis.props.onStopMultiSelect();\n\t\t}\n\t}\n\n\tonShiftSelection( clientId ) {\n\t\tif ( ! this.props.isSelectionEnabled ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { selectionStartClientId, onMultiSelect, onSelect } = this.props;\n\n\t\tif ( selectionStartClientId ) {\n\t\t\tonMultiSelect( selectionStartClientId, clientId );\n\t\t} else {\n\t\t\tonSelect( clientId );\n\t\t}\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tblockClientIds,\n\t\t\trootClientId,\n\t\t\tisDraggable,\n\t\t} = this.props;\n\n\t\treturn (\n\t\t\t<div className=\"editor-block-list__layout\">\n\t\t\t\t{ map( blockClientIds, ( clientId, blockIndex ) => (\n\t\t\t\t\t<BlockListBlock\n\t\t\t\t\t\tkey={ 'block-' + clientId }\n\t\t\t\t\t\tindex={ blockIndex }\n\t\t\t\t\t\tclientId={ clientId }\n\t\t\t\t\t\tblockRef={ this.setBlockRef }\n\t\t\t\t\t\tonSelectionStart={ this.onSelectionStart }\n\t\t\t\t\t\tonShiftSelection={ this.onShiftSelection }\n\t\t\t\t\t\trootClientId={ rootClientId }\n\t\t\t\t\t\tisFirst={ blockIndex === 0 }\n\t\t\t\t\t\tisLast={ blockIndex === blockClientIds.length - 1 }\n\t\t\t\t\t\tisDraggable={ isDraggable }\n\t\t\t\t\t/>\n\t\t\t\t) ) }\n\t\t\t\t<BlockListAppender rootClientId={ rootClientId } />\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select, ownProps ) => {\n\t\tconst {\n\t\t\tgetBlockOrder,\n\t\t\tisSelectionEnabled,\n\t\t\tisMultiSelecting,\n\t\t\tgetMultiSelectedBlocksStartClientId,\n\t\t\tgetMultiSelectedBlocksEndClientId,\n\t\t\tgetBlockSelectionStart,\n\t\t} = select( 'core/editor' );\n\t\tconst { rootClientId } = ownProps;\n\n\t\treturn {\n\t\t\tblockClientIds: getBlockOrder( rootClientId ),\n\t\t\tselectionStart: getMultiSelectedBlocksStartClientId(),\n\t\t\tselectionEnd: getMultiSelectedBlocksEndClientId(),\n\t\t\tselectionStartClientId: isSelectionEnabled() && getBlockSelectionStart(),\n\t\t\tisSelectionEnabled: isSelectionEnabled(),\n\t\t\tisMultiSelecting: isMultiSelecting(),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => {\n\t\tconst {\n\t\t\tstartMultiSelect,\n\t\t\tstopMultiSelect,\n\t\t\tmultiSelect,\n\t\t\tselectBlock,\n\t\t} = dispatch( 'core/editor' );\n\n\t\treturn {\n\t\t\tonStartMultiSelect: startMultiSelect,\n\t\t\tonStopMultiSelect: stopMultiSelect,\n\t\t\tonMultiSelect: multiSelect,\n\t\t\tonSelect: selectBlock,\n\t\t};\n\t} ),\n] )( BlockList );\n"]}