{"version":3,"sources":["/Users/ky/Sites/valet/copesacontent/web/app/plugins/gutenberg/packages/editor/src/components/url-input/index.js"],"names":["stopEventPropagation","event","stopPropagation","URLInput","autocompleteRef","arguments","onChange","bind","onKeyDown","updateSuggestions","suggestionNodes","state","posts","showSuggestions","selectedSuggestion","scrollingIntoView","current","onlyScrollIfNeeded","setTimeout","suggestionsRequest","index","ref","value","length","test","setState","loading","request","path","search","per_page","type","then","props","debouncedSpeak","catch","inputValue","target","keyCode","UP","preventDefault","previousIndex","DOWN","nextIndex","ENTER","post","selectLink","url","autoFocus","instanceId","undefined","map","id","bindSuggestionNode","title","Component"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { throttle } from 'lodash';\nimport classnames from 'classnames';\nimport scrollIntoView from 'dom-scroll-into-view';\n\n/**\n * WordPress dependencies\n */\nimport { __, sprintf, _n } from '@wordpress/i18n';\nimport { Component, Fragment, createRef } from '@wordpress/element';\nimport { decodeEntities } from '@wordpress/html-entities';\nimport { UP, DOWN, ENTER } from '@wordpress/keycodes';\nimport { Spinner, withSpokenMessages, Popover } from '@wordpress/components';\nimport { withInstanceId } from '@wordpress/compose';\nimport apiFetch from '@wordpress/api-fetch';\nimport { addQueryArgs } from '@wordpress/url';\n\n// Since URLInput is rendered in the context of other inputs, but should be\n// considered a separate modal node, prevent keyboard events from propagating\n// as being considered from the input.\nconst stopEventPropagation = ( event ) => event.stopPropagation();\n\nclass URLInput extends Component {\n\tconstructor( { autocompleteRef } ) {\n\t\tsuper( ...arguments );\n\n\t\tthis.onChange = this.onChange.bind( this );\n\t\tthis.onKeyDown = this.onKeyDown.bind( this );\n\t\tthis.autocompleteRef = autocompleteRef || createRef();\n\t\tthis.updateSuggestions = throttle( this.updateSuggestions.bind( this ), 200 );\n\n\t\tthis.suggestionNodes = [];\n\n\t\tthis.state = {\n\t\t\tposts: [],\n\t\t\tshowSuggestions: false,\n\t\t\tselectedSuggestion: null,\n\t\t};\n\t}\n\n\tcomponentDidUpdate() {\n\t\tconst { showSuggestions, selectedSuggestion } = this.state;\n\t\t// only have to worry about scrolling selected suggestion into view\n\t\t// when already expanded\n\t\tif ( showSuggestions && selectedSuggestion !== null && ! this.scrollingIntoView ) {\n\t\t\tthis.scrollingIntoView = true;\n\t\t\tscrollIntoView( this.suggestionNodes[ selectedSuggestion ], this.autocompleteRef.current, {\n\t\t\t\tonlyScrollIfNeeded: true,\n\t\t\t} );\n\n\t\t\tsetTimeout( () => {\n\t\t\t\tthis.scrollingIntoView = false;\n\t\t\t}, 100 );\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tdelete this.suggestionsRequest;\n\t}\n\n\tbindSuggestionNode( index ) {\n\t\treturn ( ref ) => {\n\t\t\tthis.suggestionNodes[ index ] = ref;\n\t\t};\n\t}\n\n\tupdateSuggestions( value ) {\n\t\t// Show the suggestions after typing at least 2 characters\n\t\t// and also for URLs\n\t\tif ( value.length < 2 || /^https?:/.test( value ) ) {\n\t\t\tthis.setState( {\n\t\t\t\tshowSuggestions: false,\n\t\t\t\tselectedSuggestion: null,\n\t\t\t\tloading: false,\n\t\t\t} );\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setState( {\n\t\t\tshowSuggestions: true,\n\t\t\tselectedSuggestion: null,\n\t\t\tloading: true,\n\t\t} );\n\n\t\tconst request = apiFetch( {\n\t\t\tpath: addQueryArgs( '/wp/v2/search', {\n\t\t\t\tsearch: value,\n\t\t\t\tper_page: 20,\n\t\t\t\ttype: 'post',\n\t\t\t} ),\n\t\t} );\n\n\t\trequest.then( ( posts ) => {\n\t\t\t// A fetch Promise doesn't have an abort option. It's mimicked by\n\t\t\t// comparing the request reference in on the instance, which is\n\t\t\t// reset or deleted on subsequent requests or unmounting.\n\t\t\tif ( this.suggestionsRequest !== request ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.setState( {\n\t\t\t\tposts,\n\t\t\t\tloading: false,\n\t\t\t} );\n\n\t\t\tif ( !! posts.length ) {\n\t\t\t\tthis.props.debouncedSpeak( sprintf( _n(\n\t\t\t\t\t'%d result found, use up and down arrow keys to navigate.',\n\t\t\t\t\t'%d results found, use up and down arrow keys to navigate.',\n\t\t\t\t\tposts.length\n\t\t\t\t), posts.length ), 'assertive' );\n\t\t\t} else {\n\t\t\t\tthis.props.debouncedSpeak( __( 'No results.' ), 'assertive' );\n\t\t\t}\n\t\t} ).catch( () => {\n\t\t\tif ( this.suggestionsRequest === request ) {\n\t\t\t\tthis.setState( {\n\t\t\t\t\tloading: false,\n\t\t\t\t} );\n\t\t\t}\n\t\t} );\n\n\t\tthis.suggestionsRequest = request;\n\t}\n\n\tonChange( event ) {\n\t\tconst inputValue = event.target.value;\n\t\tthis.props.onChange( inputValue );\n\t\tthis.updateSuggestions( inputValue );\n\t}\n\n\tonKeyDown( event ) {\n\t\tconst { showSuggestions, selectedSuggestion, posts, loading } = this.state;\n\t\t// If the suggestions are not shown or loading, we shouldn't handle the arrow keys\n\t\t// We shouldn't preventDefault to allow block arrow keys navigation\n\t\tif ( ! showSuggestions || ! posts.length || loading ) {\n\t\t\treturn;\n\t\t}\n\n\t\tswitch ( event.keyCode ) {\n\t\t\tcase UP: {\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tevent.preventDefault();\n\t\t\t\tconst previousIndex = ! selectedSuggestion ? posts.length - 1 : selectedSuggestion - 1;\n\t\t\t\tthis.setState( {\n\t\t\t\t\tselectedSuggestion: previousIndex,\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase DOWN: {\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tevent.preventDefault();\n\t\t\t\tconst nextIndex = selectedSuggestion === null || ( selectedSuggestion === posts.length - 1 ) ? 0 : selectedSuggestion + 1;\n\t\t\t\tthis.setState( {\n\t\t\t\t\tselectedSuggestion: nextIndex,\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ENTER: {\n\t\t\t\tif ( this.state.selectedSuggestion !== null ) {\n\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\tconst post = this.state.posts[ this.state.selectedSuggestion ];\n\t\t\t\t\tthis.selectLink( post );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tselectLink( post ) {\n\t\tthis.props.onChange( post.url, post );\n\t\tthis.setState( {\n\t\t\tselectedSuggestion: null,\n\t\t\tshowSuggestions: false,\n\t\t} );\n\t}\n\n\trender() {\n\t\tconst { value = '', autoFocus = true, instanceId } = this.props;\n\t\tconst { showSuggestions, posts, selectedSuggestion, loading } = this.state;\n\t\t/* eslint-disable jsx-a11y/no-autofocus */\n\t\treturn (\n\t\t\t<Fragment>\n\t\t\t\t<div className=\"editor-url-input\">\n\t\t\t\t\t<input\n\t\t\t\t\t\tautoFocus={ autoFocus }\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\taria-label={ __( 'URL' ) }\n\t\t\t\t\t\trequired\n\t\t\t\t\t\tvalue={ value }\n\t\t\t\t\t\tonChange={ this.onChange }\n\t\t\t\t\t\tonInput={ stopEventPropagation }\n\t\t\t\t\t\tplaceholder={ __( 'Paste URL or type to search' ) }\n\t\t\t\t\t\tonKeyDown={ this.onKeyDown }\n\t\t\t\t\t\trole=\"combobox\"\n\t\t\t\t\t\taria-expanded={ showSuggestions }\n\t\t\t\t\t\taria-autocomplete=\"list\"\n\t\t\t\t\t\taria-owns={ `editor-url-input-suggestions-${ instanceId }` }\n\t\t\t\t\t\taria-activedescendant={ selectedSuggestion !== null ? `editor-url-input-suggestion-${ instanceId }-${ selectedSuggestion }` : undefined }\n\t\t\t\t\t/>\n\n\t\t\t\t\t{ ( loading ) && <Spinner /> }\n\t\t\t\t</div>\n\n\t\t\t\t{ showSuggestions && !! posts.length &&\n\t\t\t\t\t<Popover position=\"bottom\" noArrow focusOnMount={ false }>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName=\"editor-url-input__suggestions\"\n\t\t\t\t\t\t\tid={ `editor-url-input-suggestions-${ instanceId }` }\n\t\t\t\t\t\t\tref={ this.autocompleteRef }\n\t\t\t\t\t\t\trole=\"listbox\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ posts.map( ( post, index ) => (\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tkey={ post.id }\n\t\t\t\t\t\t\t\t\trole=\"option\"\n\t\t\t\t\t\t\t\t\ttabIndex=\"-1\"\n\t\t\t\t\t\t\t\t\tid={ `editor-url-input-suggestion-${ instanceId }-${ index }` }\n\t\t\t\t\t\t\t\t\tref={ this.bindSuggestionNode( index ) }\n\t\t\t\t\t\t\t\t\tclassName={ classnames( 'editor-url-input__suggestion', {\n\t\t\t\t\t\t\t\t\t\t'is-selected': index === selectedSuggestion,\n\t\t\t\t\t\t\t\t\t} ) }\n\t\t\t\t\t\t\t\t\tonClick={ () => this.selectLink( post ) }\n\t\t\t\t\t\t\t\t\taria-selected={ index === selectedSuggestion }\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{ decodeEntities( post.title ) || __( '(no title)' ) }\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t) ) }\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</Popover>\n\t\t\t\t}\n\t\t\t</Fragment>\n\t\t);\n\t\t/* eslint-enable jsx-a11y/no-autofocus */\n\t}\n}\n\nexport default withSpokenMessages( withInstanceId( URLInput ) );\n"]}