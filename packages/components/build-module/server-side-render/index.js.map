{"version":3,"sources":["/Users/ky/Sites/valet/copesacontent/web/app/plugins/gutenberg/packages/components/src/server-side-render/index.js"],"names":["isEqual","Component","RawHTML","__","sprintf","apiFetch","addQueryArgs","Placeholder","Spinner","rendererPath","block","attributes","urlQueryArgs","context","ServerSideRender","props","state","response","isStillMounted","fetch","prevProps","setState","path","then","rendered","catch","error","errorMsg","message","errorMessage","length"],"mappings":"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","sourcesContent":["/**\n * External dependencies.\n */\nimport { isEqual } from 'lodash';\n\n/**\n * WordPress dependencies.\n */\nimport {\n\tComponent,\n\tRawHTML,\n} from '@wordpress/element';\nimport { __, sprintf } from '@wordpress/i18n';\nimport apiFetch from '@wordpress/api-fetch';\nimport { addQueryArgs } from '@wordpress/url';\n\n/**\n * Internal dependencies.\n */\nimport Placeholder from '../placeholder';\nimport Spinner from '../spinner';\n\nexport function rendererPath( block, attributes = null, urlQueryArgs = {} ) {\n\treturn addQueryArgs( `/wp/v2/block-renderer/${ block }`, {\n\t\tcontext: 'edit',\n\t\t...( null !== attributes ? { attributes } : {} ),\n\t\t...urlQueryArgs,\n\t} );\n}\n\nexport class ServerSideRender extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\t\tthis.state = {\n\t\t\tresponse: null,\n\t\t};\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.isStillMounted = true;\n\t\tthis.fetch( this.props );\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.isStillMounted = false;\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tif ( ! isEqual( prevProps, this.props ) ) {\n\t\t\tthis.fetch( this.props );\n\t\t}\n\t}\n\n\tfetch( props ) {\n\t\tif ( null !== this.state.response ) {\n\t\t\tthis.setState( { response: null } );\n\t\t}\n\t\tconst { block, attributes = null, urlQueryArgs = {} } = props;\n\n\t\tconst path = rendererPath( block, attributes, urlQueryArgs );\n\n\t\treturn apiFetch( { path } )\n\t\t\t.then( ( response ) => {\n\t\t\t\tif ( this.isStillMounted && response && response.rendered ) {\n\t\t\t\t\tthis.setState( { response: response.rendered } );\n\t\t\t\t}\n\t\t\t} )\n\t\t\t.catch( ( error ) => {\n\t\t\t\tif ( this.isStillMounted ) {\n\t\t\t\t\tthis.setState( { response: {\n\t\t\t\t\t\terror: true,\n\t\t\t\t\t\terrorMsg: error.message,\n\t\t\t\t\t} } );\n\t\t\t\t}\n\t\t\t} );\n\t}\n\n\trender() {\n\t\tconst response = this.state.response;\n\t\tif ( ! response ) {\n\t\t\treturn (\n\t\t\t\t<Placeholder><Spinner /></Placeholder>\n\t\t\t);\n\t\t} else if ( response.error ) {\n\t\t\t// translators: %s: error message describing the problem\n\t\t\tconst errorMessage = sprintf( __( 'Error loading block: %s' ), response.errorMsg );\n\t\t\treturn (\n\t\t\t\t<Placeholder>{ errorMessage }</Placeholder>\n\t\t\t);\n\t\t} else if ( ! response.length ) {\n\t\t\treturn (\n\t\t\t\t<Placeholder>{ __( 'No results found.' ) }</Placeholder>\n\t\t\t);\n\t\t}\n\n\t\treturn (\n\t\t\t<RawHTML key=\"html\">{ response }</RawHTML>\n\t\t);\n\t}\n}\n\nexport default ServerSideRender;\n"]}