{"version":3,"sources":["/Users/ky/Sites/valet/copesacontent/web/app/plugins/gutenberg/packages/block-library/src/embed/edit.js"],"names":["isFromWordPress","createUpgradedEmbedBlock","getClassNames","EmbedControls","EmbedLoading","EmbedPlaceholder","EmbedPreview","kebabCase","toLower","__","sprintf","Component","Fragment","getEmbedEditComponent","title","icon","responsive","arguments","switchBackToURLInput","bind","setUrl","getAttributesFromPreview","setAttributesFromPreview","getResponsiveHelp","toggleResponsive","handleIncomingPreview","state","editingURL","url","props","attributes","preview","allowResponsive","upgradedBlock","onReplace","prevProps","hasPreview","undefined","hadPreview","switchedPreview","switchedURL","cannotEmbed","event","preventDefault","setAttributes","setState","type","html","providerName","provider_name","providerNameSlug","className","checked","newAllowResponsive","caption","fetching","isSelected","themeSupportsResponsive","label","target","value"],"mappings":"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","sourcesContent":["/**\n * Internal dependencies\n */\nimport { isFromWordPress, createUpgradedEmbedBlock, getClassNames } from './util';\nimport EmbedControls from './embed-controls';\nimport EmbedLoading from './embed-loading';\nimport EmbedPlaceholder from './embed-placeholder';\nimport EmbedPreview from './embed-preview';\n\n/**\n * External dependencies\n */\nimport { kebabCase, toLower } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { __, sprintf } from '@wordpress/i18n';\nimport { Component, Fragment } from '@wordpress/element';\n\nexport function getEmbedEditComponent( title, icon, responsive = true ) {\n\treturn class extends Component {\n\t\tconstructor() {\n\t\t\tsuper( ...arguments );\n\t\t\tthis.switchBackToURLInput = this.switchBackToURLInput.bind( this );\n\t\t\tthis.setUrl = this.setUrl.bind( this );\n\t\t\tthis.getAttributesFromPreview = this.getAttributesFromPreview.bind( this );\n\t\t\tthis.setAttributesFromPreview = this.setAttributesFromPreview.bind( this );\n\t\t\tthis.getResponsiveHelp = this.getResponsiveHelp.bind( this );\n\t\t\tthis.toggleResponsive = this.toggleResponsive.bind( this );\n\t\t\tthis.handleIncomingPreview = this.handleIncomingPreview.bind( this );\n\n\t\t\tthis.state = {\n\t\t\t\teditingURL: false,\n\t\t\t\turl: this.props.attributes.url,\n\t\t\t};\n\n\t\t\tif ( this.props.preview ) {\n\t\t\t\tthis.handleIncomingPreview();\n\t\t\t}\n\t\t}\n\n\t\thandleIncomingPreview() {\n\t\t\tconst { allowResponsive } = this.props.attributes;\n\t\t\tthis.setAttributesFromPreview();\n\t\t\tconst upgradedBlock = createUpgradedEmbedBlock(\n\t\t\t\tthis.props,\n\t\t\t\tthis.getAttributesFromPreview( this.props.preview, allowResponsive )\n\t\t\t);\n\t\t\tif ( upgradedBlock ) {\n\t\t\t\tthis.props.onReplace( upgradedBlock );\n\t\t\t}\n\t\t}\n\n\t\tcomponentDidUpdate( prevProps ) {\n\t\t\tconst hasPreview = undefined !== this.props.preview;\n\t\t\tconst hadPreview = undefined !== prevProps.preview;\n\t\t\tconst switchedPreview = this.props.preview && this.props.attributes.url !== prevProps.attributes.url;\n\t\t\tconst switchedURL = this.props.attributes.url !== prevProps.attributes.url;\n\n\t\t\tif ( ( hasPreview && ! hadPreview ) || switchedPreview || switchedURL ) {\n\t\t\t\tif ( this.props.cannotEmbed ) {\n\t\t\t\t\t// Can't embed this URL, and we've just received or switched the preview.\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.handleIncomingPreview();\n\t\t\t}\n\t\t}\n\n\t\tsetUrl( event ) {\n\t\t\tif ( event ) {\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t\tconst { url } = this.state;\n\t\t\tconst { setAttributes } = this.props;\n\t\t\tthis.setState( { editingURL: false } );\n\t\t\tsetAttributes( { url } );\n\t\t}\n\n\t\t/***\n\t\t * Gets block attributes based on the preview and responsive state.\n\t\t *\n\t\t * @param {string} preview The preview data.\n\t\t * @param {boolean} allowResponsive Apply responsive classes to fixed size content.\n\t\t * @return {Object} Attributes and values.\n\t\t */\n\t\tgetAttributesFromPreview( preview, allowResponsive = true ) {\n\t\t\tconst attributes = {};\n\t\t\t// Some plugins only return HTML with no type info, so default this to 'rich'.\n\t\t\tlet { type = 'rich' } = preview;\n\t\t\t// If we got a provider name from the API, use it for the slug, otherwise we use the title,\n\t\t\t// because not all embed code gives us a provider name.\n\t\t\tconst { html, provider_name: providerName } = preview;\n\t\t\tconst providerNameSlug = kebabCase( toLower( '' !== providerName ? providerName : title ) );\n\n\t\t\tif ( isFromWordPress( html ) ) {\n\t\t\t\ttype = 'wp-embed';\n\t\t\t}\n\n\t\t\tif ( html || 'photo' === type ) {\n\t\t\t\tattributes.type = type;\n\t\t\t\tattributes.providerNameSlug = providerNameSlug;\n\t\t\t}\n\n\t\t\tattributes.className = getClassNames( html, this.props.attributes.className, responsive && allowResponsive );\n\n\t\t\treturn attributes;\n\t\t}\n\n\t\t/***\n\t\t * Sets block attributes based on the preview data.\n\t\t */\n\t\tsetAttributesFromPreview() {\n\t\t\tconst { setAttributes, preview } = this.props;\n\t\t\tconst { allowResponsive } = this.props.attributes;\n\t\t\tsetAttributes( this.getAttributesFromPreview( preview, allowResponsive ) );\n\t\t}\n\n\t\tswitchBackToURLInput() {\n\t\t\tthis.setState( { editingURL: true } );\n\t\t}\n\n\t\tgetResponsiveHelp( checked ) {\n\t\t\treturn checked ? __( 'This embed will preserve its aspect ratio when the browser is resized.' ) : __( 'This embed may not preserve its aspect ratio when the browser is resized.' );\n\t\t}\n\n\t\ttoggleResponsive() {\n\t\t\tconst { allowResponsive, className } = this.props.attributes;\n\t\t\tconst { html } = this.props.preview;\n\t\t\tconst newAllowResponsive = ! allowResponsive;\n\n\t\t\tthis.props.setAttributes(\n\t\t\t\t{\n\t\t\t\t\tallowResponsive: newAllowResponsive,\n\t\t\t\t\tclassName: getClassNames( html, className, responsive && newAllowResponsive ),\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\trender() {\n\t\t\tconst { url, editingURL } = this.state;\n\t\t\tconst { caption, type, allowResponsive } = this.props.attributes;\n\t\t\tconst { fetching, setAttributes, isSelected, className, preview, cannotEmbed, themeSupportsResponsive } = this.props;\n\n\t\t\tif ( fetching ) {\n\t\t\t\treturn (\n\t\t\t\t\t<EmbedLoading />\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// translators: %s: type of embed e.g: \"YouTube\", \"Twitter\", etc. \"Embed\" is used when no specific type exists\n\t\t\tconst label = sprintf( __( '%s URL' ), title );\n\n\t\t\t// No preview, or we can't embed the current URL, or we've clicked the edit button.\n\t\t\tif ( ! preview || cannotEmbed || editingURL ) {\n\t\t\t\treturn (\n\t\t\t\t\t<EmbedPlaceholder\n\t\t\t\t\t\ticon={ icon }\n\t\t\t\t\t\tlabel={ label }\n\t\t\t\t\t\tonSubmit={ this.setUrl }\n\t\t\t\t\t\tvalue={ url }\n\t\t\t\t\t\tcannotEmbed={ cannotEmbed }\n\t\t\t\t\t\tonChange={ ( event ) => this.setState( { url: event.target.value } ) }\n\t\t\t\t\t/>\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t<Fragment>\n\t\t\t\t\t<EmbedControls\n\t\t\t\t\t\tshowEditButton={ preview && ! cannotEmbed }\n\t\t\t\t\t\tthemeSupportsResponsive={ themeSupportsResponsive }\n\t\t\t\t\t\tblockSupportsResponsive={ responsive }\n\t\t\t\t\t\tallowResponsive={ allowResponsive }\n\t\t\t\t\t\tgetResponsiveHelp={ this.getResponsiveHelp }\n\t\t\t\t\t\ttoggleResponsive={ this.toggleResponsive }\n\t\t\t\t\t\tswitchBackToURLInput={ this.switchBackToURLInput }\n\t\t\t\t\t/>\n\t\t\t\t\t<EmbedPreview\n\t\t\t\t\t\tpreview={ preview }\n\t\t\t\t\t\tclassName={ className }\n\t\t\t\t\t\turl={ url }\n\t\t\t\t\t\ttype={ type }\n\t\t\t\t\t\tcaption={ caption }\n\t\t\t\t\t\tonCaptionChange={ ( value ) => setAttributes( { caption: value } ) }\n\t\t\t\t\t\tisSelected={ isSelected }\n\t\t\t\t\t\ticon={ icon }\n\t\t\t\t\t\tlabel={ label }\n\t\t\t\t\t/>\n\t\t\t\t</Fragment>\n\t\t\t);\n\t\t}\n\t};\n}\n"]}