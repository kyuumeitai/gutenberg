{"version":3,"sources":["/Users/ky/Sites/valet/copesacontent/web/app/plugins/gutenberg/packages/editor/src/components/inner-blocks/index.js"],"names":["pick","isEqual","map","classnames","withViewportMatch","Component","withSelect","withDispatch","synchronizeBlocksWithTemplate","withBlockContentContext","isShallowEqual","compose","BlockList","withBlockEditContext","InnerBlocks","arguments","updateNestedSettings","props","templateLock","parentLock","undefined","innerBlocks","block","length","getTemplateLock","prevProps","template","hasTemplateChanged","replaceInnerBlocks","nextBlocks","blockListSettings","allowedBlocks","newSettings","clientId","isSmallScreen","isSelectedBlockInRoot","classes","context","select","ownProps","isBlockSelected","hasSelectedInnerBlock","getBlock","getBlockListSettings","getBlockRootClientId","rootClientId","dispatch","replaceBlocks","insertBlocks","updateBlockListSettings","blocks","clientIds","settings","Content","BlockContent"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { pick, isEqual, map } from 'lodash';\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { withViewportMatch } from '@wordpress/viewport';\nimport { Component } from '@wordpress/element';\nimport { withSelect, withDispatch } from '@wordpress/data';\nimport { synchronizeBlocksWithTemplate, withBlockContentContext } from '@wordpress/blocks';\nimport isShallowEqual from '@wordpress/is-shallow-equal';\nimport { compose } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport BlockList from '../block-list';\nimport { withBlockEditContext } from '../block-edit/context';\n\nclass InnerBlocks extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.updateNestedSettings();\n\t}\n\n\tgetTemplateLock() {\n\t\tconst {\n\t\t\ttemplateLock,\n\t\t\tparentLock,\n\t\t} = this.props;\n\t\treturn templateLock === undefined ? parentLock : templateLock;\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { innerBlocks } = this.props.block;\n\t\t// only synchronize innerBlocks with template if innerBlocks are empty or a locking all exists\n\t\tif ( innerBlocks.length === 0 || this.getTemplateLock() === 'all' ) {\n\t\t\treturn \tthis.synchronizeBlocksWithTemplate();\n\t\t}\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst { template, block } = this.props;\n\t\tconst { innerBlocks } = block;\n\n\t\tthis.updateNestedSettings();\n\t\t// only synchronize innerBlocks with template if innerBlocks are empty or a locking all exists\n\t\tif ( innerBlocks.length === 0 || this.getTemplateLock() === 'all' ) {\n\t\t\tconst hasTemplateChanged = ! isEqual( template, prevProps.template );\n\t\t\tif ( hasTemplateChanged ) {\n\t\t\t\tthis.synchronizeBlocksWithTemplate();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Called on mount or when a mismatch exists between the templates and\n\t * inner blocks, synchronizes inner blocks with the template, replacing\n\t * current blocks.\n\t */\n\tsynchronizeBlocksWithTemplate() {\n\t\tconst { template, block, replaceInnerBlocks } = this.props;\n\t\tconst { innerBlocks } = block;\n\n\t\t// Synchronize with templates. If the next set differs, replace.\n\t\tconst nextBlocks = synchronizeBlocksWithTemplate( innerBlocks, template );\n\t\tif ( ! isEqual( nextBlocks, innerBlocks\t) ) {\n\t\t\treplaceInnerBlocks( nextBlocks );\n\t\t}\n\t}\n\n\tupdateNestedSettings() {\n\t\tconst {\n\t\t\tblockListSettings,\n\t\t\tallowedBlocks,\n\t\t\tupdateNestedSettings,\n\t\t} = this.props;\n\n\t\tconst newSettings = {\n\t\t\tallowedBlocks,\n\t\t\ttemplateLock: this.getTemplateLock(),\n\t\t};\n\n\t\tif ( ! isShallowEqual( blockListSettings, newSettings ) ) {\n\t\t\tupdateNestedSettings( newSettings );\n\t\t}\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tclientId,\n\t\t\tallowedBlocks,\n\t\t\ttemplateLock,\n\t\t\ttemplate,\n\t\t\tisSmallScreen,\n\t\t\tisSelectedBlockInRoot,\n\t\t} = this.props;\n\n\t\tconst classes = classnames( 'editor-inner-blocks', {\n\t\t\t'has-overlay': isSmallScreen && ! isSelectedBlockInRoot,\n\t\t} );\n\n\t\treturn (\n\t\t\t<div className={ classes }>\n\t\t\t\t<BlockList\n\t\t\t\t\trootClientId={ clientId }\n\t\t\t\t\t{ ...{ allowedBlocks, templateLock, template } }\n\t\t\t\t/>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nInnerBlocks = compose( [\n\twithBlockEditContext( ( context ) => pick( context, [ 'clientId' ] ) ),\n\twithViewportMatch( { isSmallScreen: '< medium' } ),\n\twithSelect( ( select, ownProps ) => {\n\t\tconst {\n\t\t\tisBlockSelected,\n\t\t\thasSelectedInnerBlock,\n\t\t\tgetBlock,\n\t\t\tgetBlockListSettings,\n\t\t\tgetBlockRootClientId,\n\t\t\tgetTemplateLock,\n\t\t} = select( 'core/editor' );\n\t\tconst { clientId } = ownProps;\n\t\tconst rootClientId = getBlockRootClientId( clientId );\n\t\treturn {\n\t\t\tisSelectedBlockInRoot: isBlockSelected( clientId ) || hasSelectedInnerBlock( clientId ),\n\t\t\tblock: getBlock( clientId ),\n\t\t\tblockListSettings: getBlockListSettings( clientId ),\n\t\t\tparentLock: getTemplateLock( rootClientId ),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch, ownProps ) => {\n\t\tconst {\n\t\t\treplaceBlocks,\n\t\t\tinsertBlocks,\n\t\t\tupdateBlockListSettings,\n\t\t} = dispatch( 'core/editor' );\n\t\tconst { block, clientId } = ownProps;\n\n\t\treturn {\n\t\t\treplaceInnerBlocks( blocks ) {\n\t\t\t\tconst clientIds = map( block.innerBlocks, 'clientId' );\n\t\t\t\tif ( clientIds.length ) {\n\t\t\t\t\treplaceBlocks( clientIds, blocks );\n\t\t\t\t} else {\n\t\t\t\t\tinsertBlocks( blocks, undefined, clientId );\n\t\t\t\t}\n\t\t\t},\n\t\t\tupdateNestedSettings( settings ) {\n\t\t\t\tdispatch( updateBlockListSettings( clientId, settings ) );\n\t\t\t},\n\t\t};\n\t} ),\n] )( InnerBlocks );\n\nInnerBlocks.Content = withBlockContentContext(\n\t( { BlockContent } ) => <BlockContent />\n);\n\nexport default InnerBlocks;\n"]}