{"version":3,"sources":["/Users/ky/Sites/valet/copesacontent/web/app/plugins/gutenberg/packages/data/src/registry.js"],"names":["without","mapValues","deprecated","createNamespace","dataStore","createRegistry","storeConfigs","stores","listeners","globalListener","forEach","listener","subscribe","push","select","reducerKey","store","getSelectors","dispatch","getActions","withPlugins","attributes","attribute","key","registry","apply","arguments","registerGenericStore","config","TypeError","namespaces","use","registerReducer","reducer","alternative","plugin","version","namespace","registerActions","actions","registerSelectors","selectors","registerResolvers","resolvers","registerStore","options","Object","entries","map","name"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport {\n\twithout,\n\tmapValues,\n} from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport deprecated from '@wordpress/deprecated';\n\n/**\n * Internal dependencies\n */\nimport createNamespace from './namespace-store.js';\nimport dataStore from './store';\n\n/**\n * An isolated orchestrator of store registrations.\n *\n * @typedef {WPDataRegistry}\n *\n * @property {Function} registerGenericStore\n * @property {Function} registerStore\n * @property {Function} subscribe\n * @property {Function} select\n * @property {Function} dispatch\n */\n\n/**\n * An object of registry function overrides.\n *\n * @typedef {WPDataPlugin}\n */\n\n/**\n * Creates a new store registry, given an optional object of initial store\n * configurations.\n *\n * @param {Object} storeConfigs Initial store configurations.\n *\n * @return {WPDataRegistry} Data registry.\n */\nexport function createRegistry( storeConfigs = {} ) {\n\tconst stores = {};\n\tlet listeners = [];\n\n\t/**\n\t * Global listener called for each store's update.\n\t */\n\tfunction globalListener() {\n\t\tlisteners.forEach( ( listener ) => listener() );\n\t}\n\n\t/**\n\t * Subscribe to changes to any data.\n\t *\n\t * @param {Function}   listener Listener function.\n\t *\n\t * @return {Function}           Unsubscribe function.\n\t */\n\tconst subscribe = ( listener ) => {\n\t\tlisteners.push( listener );\n\n\t\treturn () => {\n\t\t\tlisteners = without( listeners, listener );\n\t\t};\n\t};\n\n\t/**\n\t * Calls a selector given the current state and extra arguments.\n\t *\n\t * @param {string} reducerKey Part of the state shape to register the\n\t *                            selectors for.\n\t *\n\t * @return {*} The selector's returned value.\n\t */\n\tfunction select( reducerKey ) {\n\t\tconst store = stores[ reducerKey ];\n\t\treturn store && store.getSelectors();\n\t}\n\n\t/**\n\t * Returns the available actions for a part of the state.\n\t *\n\t * @param {string} reducerKey Part of the state shape to dispatch the\n\t *                            action for.\n\t *\n\t * @return {*} The action's returned value.\n\t */\n\tfunction dispatch( reducerKey ) {\n\t\tconst store = stores[ reducerKey ];\n\t\treturn store && store.getActions();\n\t}\n\n\t//\n\t// Deprecated\n\t// TODO: Remove this after `use()` is removed.\n\t//\n\tfunction withPlugins( attributes ) {\n\t\treturn mapValues( attributes, ( attribute, key ) => {\n\t\t\tif ( typeof attribute !== 'function' ) {\n\t\t\t\treturn attribute;\n\t\t\t}\n\t\t\treturn function() {\n\t\t\t\treturn registry[ key ].apply( null, arguments );\n\t\t\t};\n\t\t} );\n\t}\n\n\t/**\n\t * Registers a generic store.\n\t *\n\t * @param {string} key    Store registry key.\n\t * @param {Object} config Configuration (getSelectors, getActions, subscribe).\n\t */\n\tfunction registerGenericStore( key, config ) {\n\t\tif ( typeof config.getSelectors !== 'function' ) {\n\t\t\tthrow new TypeError( 'config.getSelectors must be a function' );\n\t\t}\n\t\tif ( typeof config.getActions !== 'function' ) {\n\t\t\tthrow new TypeError( 'config.getActions must be a function' );\n\t\t}\n\t\tif ( typeof config.subscribe !== 'function' ) {\n\t\t\tthrow new TypeError( 'config.subscribe must be a function' );\n\t\t}\n\t\tstores[ key ] = config;\n\t\tconfig.subscribe( globalListener );\n\t}\n\n\tlet registry = {\n\t\tregisterGenericStore,\n\t\tstores,\n\t\tnamespaces: stores, // TODO: Deprecate/remove this.\n\t\tsubscribe,\n\t\tselect,\n\t\tdispatch,\n\t\tuse,\n\t};\n\n\t//\n\t// Deprecated\n\t//\n\tregistry.registerReducer = ( reducerKey, reducer ) => {\n\t\tdeprecated( 'registry.registerReducer', {\n\t\t\talternative: 'registry.registerStore',\n\t\t\tplugin: 'Gutenberg',\n\t\t\tversion: '4.4.0',\n\t\t} );\n\n\t\tconst namespace = createNamespace( reducerKey, { reducer }, registry );\n\t\tregisterGenericStore( reducerKey, namespace );\n\t\treturn namespace.store;\n\t};\n\n\t//\n\t// Deprecated\n\t//\n\tregistry.registerActions = ( reducerKey, actions ) => {\n\t\tdeprecated( 'registry.registerActions', {\n\t\t\talternative: 'registry.registerStore',\n\t\t\tplugin: 'Gutenberg',\n\t\t\tversion: '4.4.0',\n\t\t} );\n\n\t\tconst namespace = createNamespace( reducerKey, { actions }, registry );\n\t\tregisterGenericStore( reducerKey, namespace );\n\t};\n\n\t//\n\t// Deprecated\n\t//\n\tregistry.registerSelectors = ( reducerKey, selectors ) => {\n\t\tdeprecated( 'registry.registerSelectors', {\n\t\t\talternative: 'registry.registerStore',\n\t\t\tplugin: 'Gutenberg',\n\t\t\tversion: '4.4.0',\n\t\t} );\n\n\t\tconst namespace = createNamespace( reducerKey, { selectors }, registry );\n\t\tregisterGenericStore( reducerKey, namespace );\n\t};\n\n\t//\n\t// Deprecated\n\t//\n\tregistry.registerResolvers = ( reducerKey, resolvers ) => {\n\t\tdeprecated( 'registry.registerResolvers', {\n\t\t\talternative: 'registry.registerStore',\n\t\t\tplugin: 'Gutenberg',\n\t\t\tversion: '4.4.0',\n\t\t} );\n\n\t\tconst namespace = createNamespace( reducerKey, { resolvers }, registry );\n\t\tregisterGenericStore( reducerKey, namespace );\n\t};\n\n\t/**\n\t * Registers a standard `@wordpress/data` store.\n\t *\n\t * @param {string} reducerKey Reducer key.\n\t * @param {Object} options    Store description (reducer, actions, selectors, resolvers).\n\t *\n\t * @return {Object} Registered store object.\n\t */\n\tregistry.registerStore = ( reducerKey, options ) => {\n\t\tif ( ! options.reducer ) {\n\t\t\tthrow new TypeError( 'Must specify store reducer' );\n\t\t}\n\n\t\tconst namespace = createNamespace( reducerKey, options, registry );\n\t\tregisterGenericStore( reducerKey, namespace );\n\t\treturn namespace.store;\n\t};\n\n\t//\n\t// TODO:\n\t// This function will be deprecated as soon as it is no longer internally referenced.\n\t//\n\tfunction use( plugin, options ) {\n\t\tregistry = {\n\t\t\t...registry,\n\t\t\t...plugin( registry, options ),\n\t\t};\n\n\t\treturn registry;\n\t}\n\n\tObject.entries( {\n\t\t'core/data': dataStore,\n\t\t...storeConfigs,\n\t} ).map( ( [ name, config ] ) => registry.registerStore( name, config ) );\n\n\treturn withPlugins( registry );\n}\n"]}