{"version":3,"sources":["/Users/ky/Sites/valet/copesacontent/web/app/plugins/gutenberg/packages/block-library/src/classic/edit.js"],"names":["Component","__","_x","BACKSPACE","DELETE","F10","isTmceEmpty","editor","body","getBody","childNodes","length","test","innerText","textContent","ClassicEdit","props","initialize","bind","onSetup","focus","window","wpEditorL10n","tinymce","baseURL","suffix","EditorManager","overrideDefaults","base_url","document","readyState","addEventListener","wp","oldEditor","remove","clientId","prevProps","content","attributes","get","setContent","settings","inline","content_css","fixed_toolbar_container","setup","setAttributes","ref","on","event","command","preventDefault","getContent","keyCode","onReplace","stopImmediatePropagation","altKey","stopPropagation","addButton","tooltip","icon","onClick","button","active","dom","toggleClass","cmd","rootNode","activeElement","blur","nativeEvent","onToolbarKeyDown"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { __, _x } from '@wordpress/i18n';\nimport { BACKSPACE, DELETE, F10 } from '@wordpress/keycodes';\n\nfunction isTmceEmpty( editor ) {\n\t// When tinyMce is empty the content seems to be:\n\t// <p><br data-mce-bogus=\"1\"></p>\n\t// avoid expensive checks for large documents\n\tconst body = editor.getBody();\n\tif ( body.childNodes.length > 1 ) {\n\t\treturn false;\n\t} else if ( body.childNodes.length === 0 ) {\n\t\treturn true;\n\t}\n\tif ( body.childNodes[ 0 ].childNodes.length > 1 ) {\n\t\treturn false;\n\t}\n\treturn /^\\n?$/.test( body.innerText || body.textContent );\n}\n\nexport default class ClassicEdit extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\t\tthis.initialize = this.initialize.bind( this );\n\t\tthis.onSetup = this.onSetup.bind( this );\n\t\tthis.focus = this.focus.bind( this );\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { baseURL, suffix } = window.wpEditorL10n.tinymce;\n\n\t\twindow.tinymce.EditorManager.overrideDefaults( {\n\t\t\tbase_url: baseURL,\n\t\t\tsuffix,\n\t\t} );\n\n\t\tif ( document.readyState === 'complete' ) {\n\t\t\tthis.initialize();\n\t\t} else {\n\t\t\twindow.addEventListener( 'DOMContentLoaded', this.initialize );\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\twindow.addEventListener( 'DOMContentLoaded', this.initialize );\n\t\twp.oldEditor.remove( `editor-${ this.props.clientId }` );\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst { clientId, attributes: { content } } = this.props;\n\n\t\tconst editor = window.tinymce.get( `editor-${ clientId }` );\n\n\t\tif ( prevProps.attributes.content !== content ) {\n\t\t\teditor.setContent( content || '' );\n\t\t}\n\t}\n\n\tinitialize() {\n\t\tconst { clientId } = this.props;\n\t\tconst { settings } = window.wpEditorL10n.tinymce;\n\t\twp.oldEditor.initialize( `editor-${ clientId }`, {\n\t\t\ttinymce: {\n\t\t\t\t...settings,\n\t\t\t\tinline: true,\n\t\t\t\tcontent_css: false,\n\t\t\t\tfixed_toolbar_container: `#toolbar-${ clientId }`,\n\t\t\t\tsetup: this.onSetup,\n\t\t\t},\n\t\t} );\n\t}\n\n\tonSetup( editor ) {\n\t\tconst { attributes: { content }, setAttributes } = this.props;\n\t\tconst { ref } = this;\n\n\t\tthis.editor = editor;\n\n\t\t// Disable TinyMCE's keyboard shortcut help.\n\t\teditor.on( 'BeforeExecCommand', ( event ) => {\n\t\t\tif ( event.command === 'WP_Help' ) {\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t} );\n\n\t\tif ( content ) {\n\t\t\teditor.on( 'loadContent', () => editor.setContent( content ) );\n\t\t}\n\n\t\teditor.on( 'blur', () => {\n\t\t\tsetAttributes( {\n\t\t\t\tcontent: editor.getContent(),\n\t\t\t} );\n\t\t\treturn false;\n\t\t} );\n\n\t\teditor.on( 'keydown', ( event ) => {\n\t\t\tif ( ( event.keyCode === BACKSPACE || event.keyCode === DELETE ) && isTmceEmpty( editor ) ) {\n\t\t\t\t// delete the block\n\t\t\t\tthis.props.onReplace( [] );\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t}\n\n\t\t\tconst { altKey } = event;\n\t\t\t/*\n\t\t\t * Prevent Mousetrap from kicking in: TinyMCE already uses its own\n\t\t\t * `alt+f10` shortcut to focus its toolbar.\n\t\t\t */\n\t\t\tif ( altKey && event.keyCode === F10 ) {\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t} );\n\n\t\teditor.addButton( 'kitchensink', {\n\t\t\ttooltip: _x( 'More', 'button to expand options' ),\n\t\t\ticon: 'dashicon dashicons-editor-kitchensink',\n\t\t\tonClick: function() {\n\t\t\t\tconst button = this;\n\t\t\t\tconst active = ! button.active();\n\n\t\t\t\tbutton.active( active );\n\t\t\t\teditor.dom.toggleClass( ref, 'has-advanced-toolbar', active );\n\t\t\t},\n\t\t} );\n\n\t\teditor.addButton( 'wp_add_media', {\n\t\t\ttooltip: __( 'Insert Media' ),\n\t\t\ticon: 'dashicon dashicons-admin-media',\n\t\t\tcmd: 'WP_Medialib',\n\t\t} );\n\n\t\teditor.on( 'init', () => {\n\t\t\tconst rootNode = this.editor.getBody();\n\n\t\t\t// Create the toolbar by refocussing the editor.\n\t\t\tif ( document.activeElement === rootNode ) {\n\t\t\t\trootNode.blur();\n\t\t\t\tthis.editor.focus();\n\t\t\t}\n\t\t} );\n\t}\n\n\tfocus() {\n\t\tif ( this.editor ) {\n\t\t\tthis.editor.focus();\n\t\t}\n\t}\n\n\tonToolbarKeyDown( event ) {\n\t\t// Prevent WritingFlow from kicking in and allow arrows navigation on the toolbar.\n\t\tevent.stopPropagation();\n\t\t// Prevent Mousetrap from moving focus to the top toolbar when pressing `alt+f10` on this block toolbar.\n\t\tevent.nativeEvent.stopImmediatePropagation();\n\t}\n\n\trender() {\n\t\tconst { clientId } = this.props;\n\n\t\t// Disable reason: the toolbar itself is non-interactive, but must capture\n\t\t// events from the KeyboardShortcuts component to stop their propagation.\n\t\t/* eslint-disable jsx-a11y/no-static-element-interactions */\n\t\treturn [\n\t\t\t// Disable reason: Clicking on this visual placeholder should create\n\t\t\t// the toolbar, it can also be created by focussing the field below.\n\t\t\t/* eslint-disable jsx-a11y/no-static-element-interactions, jsx-a11y/click-events-have-key-events */\n\t\t\t<div\n\t\t\t\tkey=\"toolbar\"\n\t\t\t\tid={ `toolbar-${ clientId }` }\n\t\t\t\tref={ ( ref ) => this.ref = ref }\n\t\t\t\tclassName=\"block-library-classic__toolbar\"\n\t\t\t\tonClick={ this.focus }\n\t\t\t\tdata-placeholder={ __( 'Classic' ) }\n\t\t\t\tonKeyDown={ this.onToolbarKeyDown }\n\t\t\t/>,\n\t\t\t<div\n\t\t\t\tkey=\"editor\"\n\t\t\t\tid={ `editor-${ clientId }` }\n\t\t\t\tclassName=\"wp-block-freeform block-library-rich-text__tinymce\"\n\t\t\t/>,\n\t\t];\n\t\t/* eslint-enable jsx-a11y/no-static-element-interactions */\n\t}\n}\n"]}