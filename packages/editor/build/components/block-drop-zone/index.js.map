{"version":3,"sources":["/Users/ky/Sites/valet/copesacontent/web/app/plugins/gutenberg/packages/editor/src/components/block-drop-zone/index.js"],"names":["parseDropEvent","event","result","srcRootClientId","srcClientId","srcIndex","type","dataTransfer","Object","assign","JSON","parse","getData","err","BlockDropZone","arguments","onFilesDrop","bind","onHTMLDrop","onDrop","position","index","props","undefined","y","files","transformation","transform","isMatch","insertIndex","getInsertIndex","blocks","updateBlockAttributes","insertBlocks","HTML","mode","length","dstRootClientId","rootClientId","dstClientId","clientId","dstIndex","getClientIdsOfDescendants","isBlockDropType","dropType","isSameLevel","srcRoot","dstRoot","isSameBlock","src","dst","isSrcBlockAnAncestorOfDstBlock","some","id","positionIndex","moveBlockToPosition","isLocked","isAppender","Component","dispatch","ownProps","select","getTemplateLock"],"mappings":"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","sourcesContent":["/**\n * External Dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tDropZone,\n\twithFilters,\n} from '@wordpress/components';\nimport {\n\trawHandler,\n\tgetBlockTransforms,\n\tfindTransform,\n} from '@wordpress/blocks';\nimport { Component } from '@wordpress/element';\nimport { withDispatch, withSelect } from '@wordpress/data';\nimport { compose } from '@wordpress/compose';\n\nconst parseDropEvent = ( event ) => {\n\tlet result = {\n\t\tsrcRootClientId: null,\n\t\tsrcClientId: null,\n\t\tsrcIndex: null,\n\t\ttype: null,\n\t};\n\n\tif ( ! event.dataTransfer ) {\n\t\treturn result;\n\t}\n\n\ttry {\n\t\tresult = Object.assign( result, JSON.parse( event.dataTransfer.getData( 'text' ) ) );\n\t} catch ( err ) {\n\t\treturn result;\n\t}\n\n\treturn result;\n};\n\nclass BlockDropZone extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.onFilesDrop = this.onFilesDrop.bind( this );\n\t\tthis.onHTMLDrop = this.onHTMLDrop.bind( this );\n\t\tthis.onDrop = this.onDrop.bind( this );\n\t}\n\n\tgetInsertIndex( position ) {\n\t\tconst { index } = this.props;\n\t\tif ( index !== undefined ) {\n\t\t\treturn position.y === 'top' ? index : index + 1;\n\t\t}\n\t}\n\n\tonFilesDrop( files, position ) {\n\t\tconst transformation = findTransform(\n\t\t\tgetBlockTransforms( 'from' ),\n\t\t\t( transform ) => transform.type === 'files' && transform.isMatch( files )\n\t\t);\n\n\t\tif ( transformation ) {\n\t\t\tconst insertIndex = this.getInsertIndex( position );\n\t\t\tconst blocks = transformation.transform( files, this.props.updateBlockAttributes );\n\t\t\tthis.props.insertBlocks( blocks, insertIndex );\n\t\t}\n\t}\n\n\tonHTMLDrop( HTML, position ) {\n\t\tconst blocks = rawHandler( { HTML, mode: 'BLOCKS' } );\n\n\t\tif ( blocks.length ) {\n\t\t\tthis.props.insertBlocks( blocks, this.getInsertIndex( position ) );\n\t\t}\n\t}\n\n\tonDrop( event, position ) {\n\t\tconst { rootClientId: dstRootClientId, clientId: dstClientId, index: dstIndex, getClientIdsOfDescendants } = this.props;\n\t\tconst { srcRootClientId, srcClientId, srcIndex, type } = parseDropEvent( event );\n\n\t\tconst isBlockDropType = ( dropType ) => dropType === 'block';\n\t\tconst isSameLevel = ( srcRoot, dstRoot ) => {\n\t\t\t// Note that rootClientId of top-level blocks will be undefined OR a void string,\n\t\t\t// so we also need to account for that case separately.\n\t\t\treturn ( srcRoot === dstRoot ) || ( ! srcRoot === true && ! dstRoot === true );\n\t\t};\n\t\tconst isSameBlock = ( src, dst ) => src === dst;\n\t\tconst isSrcBlockAnAncestorOfDstBlock = ( src, dst ) => getClientIdsOfDescendants( [ src ] ).some( ( id ) => id === dst );\n\n\t\tif ( ! isBlockDropType( type ) ||\n\t\t\tisSameBlock( srcClientId, dstClientId ) ||\n\t\t\tisSrcBlockAnAncestorOfDstBlock( srcClientId, dstClientId ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst positionIndex = this.getInsertIndex( position );\n\t\t// If the block is kept at the same level and moved downwards,\n\t\t// subtract to account for blocks shifting upward to occupy its old position.\n\t\tconst insertIndex = dstIndex && srcIndex < dstIndex && isSameLevel( srcRootClientId, dstRootClientId ) ? positionIndex - 1 : positionIndex;\n\t\tthis.props.moveBlockToPosition( srcClientId, srcRootClientId, insertIndex );\n\t}\n\n\trender() {\n\t\tconst { isLocked, index } = this.props;\n\t\tif ( isLocked ) {\n\t\t\treturn null;\n\t\t}\n\t\tconst isAppender = index === undefined;\n\n\t\treturn (\n\t\t\t<DropZone\n\t\t\t\tclassName={ classnames( 'editor-block-drop-zone', {\n\t\t\t\t\t'is-appender': isAppender,\n\t\t\t\t} ) }\n\t\t\t\tonFilesDrop={ this.onFilesDrop }\n\t\t\t\tonHTMLDrop={ this.onHTMLDrop }\n\t\t\t\tonDrop={ this.onDrop }\n\t\t\t/>\n\t\t);\n\t}\n}\n\nexport default compose(\n\twithDispatch( ( dispatch, ownProps ) => {\n\t\tconst {\n\t\t\tinsertBlocks,\n\t\t\tupdateBlockAttributes,\n\t\t\tmoveBlockToPosition,\n\t\t} = dispatch( 'core/editor' );\n\n\t\treturn {\n\t\t\tinsertBlocks( blocks, index ) {\n\t\t\t\tconst { rootClientId } = ownProps;\n\n\t\t\t\tinsertBlocks( blocks, index, rootClientId );\n\t\t\t},\n\t\t\tupdateBlockAttributes( ...args ) {\n\t\t\t\tupdateBlockAttributes( ...args );\n\t\t\t},\n\t\t\tmoveBlockToPosition( srcClientId, srcRootClientId, dstIndex ) {\n\t\t\t\tconst { rootClientId: dstRootClientId } = ownProps;\n\t\t\t\tmoveBlockToPosition( srcClientId, srcRootClientId, dstRootClientId, dstIndex );\n\t\t\t},\n\t\t};\n\t} ),\n\twithSelect( ( select, { rootClientId } ) => {\n\t\tconst { getClientIdsOfDescendants, getTemplateLock } = select( 'core/editor' );\n\t\treturn {\n\t\t\tisLocked: !! getTemplateLock( rootClientId ),\n\t\t\tgetClientIdsOfDescendants,\n\t\t};\n\t} ),\n\twithFilters( 'editor.BlockDropZone' )\n)( BlockDropZone );\n"]}