{"version":3,"sources":["/Users/ky/Sites/valet/copesacontent/web/app/plugins/gutenberg/packages/block-library/src/file/edit.js"],"names":["classnames","__","getBlobByURL","revokeBlobURL","isBlobURL","ClipboardButton","IconButton","Toolbar","withNotices","withSelect","Component","Fragment","MediaUpload","MediaPlaceholder","BlockControls","RichText","mediaUpload","compose","FileBlockInspector","FileEdit","arguments","onSelectFile","bind","confirmCopyURL","resetCopyConfirmation","changeLinkDestinationOption","changeOpenInNewWindow","changeShowDownloadButton","state","hasError","showCopyConfirmation","props","attributes","noticeOperations","href","file","filesList","onFileChange","media","onError","message","setState","createErrorNotice","prevProps","isSelected","url","setAttributes","fileName","title","textLinkHref","id","newHref","newValue","textLinkTarget","showDownloadButton","className","noticeUI","downloadButtonText","attachmentPage","link","instructions","classes","openInNewWindow","open","text","select","getMedia","undefined"],"mappings":";;;;;;;;;;AAAA;;;AAGA,OAAOA,UAAP,MAAuB,YAAvB;AAEA;;;;AAGA,SAASC,EAAT,QAAmB,iBAAnB;AACA,SAASC,YAAT,EAAuBC,aAAvB,EAAsCC,SAAtC,QAAuD,iBAAvD;AACA,SACCC,eADD,EAECC,UAFD,EAGCC,OAHD,EAICC,WAJD,QAKO,uBALP;AAMA,SAASC,UAAT,QAA2B,iBAA3B;AACA,SAASC,SAAT,EAAoBC,QAApB,QAAoC,oBAApC;AACA,SACCC,WADD,EAECC,gBAFD,EAGCC,aAHD,EAICC,QAJD,EAKCC,WALD,QAMO,mBANP;AAOA,SAASC,OAAT,QAAwB,oBAAxB;AAEA;;;;AAGA,OAAOC,kBAAP,MAA+B,aAA/B;;IAEMC,Q;;;;;AACL,sBAAc;AAAA;;AAAA;;AACb,mFAAUC,SAAV;AAEA,UAAKC,YAAL,GAAoB,MAAKA,YAAL,CAAkBC,IAAlB,uDAApB;AACA,UAAKC,cAAL,GAAsB,MAAKA,cAAL,CAAoBD,IAApB,uDAAtB;AACA,UAAKE,qBAAL,GAA6B,MAAKA,qBAAL,CAA2BF,IAA3B,uDAA7B;AACA,UAAKG,2BAAL,GAAmC,MAAKA,2BAAL,CAAiCH,IAAjC,uDAAnC;AACA,UAAKI,qBAAL,GAA6B,MAAKA,qBAAL,CAA2BJ,IAA3B,uDAA7B;AACA,UAAKK,wBAAL,GAAgC,MAAKA,wBAAL,CAA8BL,IAA9B,uDAAhC;AAEA,UAAKM,KAAL,GAAa;AACZC,MAAAA,QAAQ,EAAE,KADE;AAEZC,MAAAA,oBAAoB,EAAE;AAFV,KAAb;AAVa;AAcb;;;;wCAEmB;AAAA;;AAAA,wBACsB,KAAKC,KAD3B;AAAA,UACXC,UADW,eACXA,UADW;AAAA,UACCC,gBADD,eACCA,gBADD;AAAA,UAEXC,IAFW,GAEFF,UAFE,CAEXE,IAFW,EAInB;;AACA,UAAK9B,SAAS,CAAE8B,IAAF,CAAd,EAAyB;AACxB,YAAMC,IAAI,GAAGjC,YAAY,CAAEgC,IAAF,CAAzB;AAEAlB,QAAAA,WAAW,CAAE;AACZoB,UAAAA,SAAS,EAAE,CAAED,IAAF,CADC;AAEZE,UAAAA,YAAY,EAAE;AAAA;AAAA,gBAAIC,KAAJ;;AAAA,mBAAiB,MAAI,CAACjB,YAAL,CAAmBiB,KAAnB,CAAjB;AAAA,WAFF;AAGZC,UAAAA,OAAO,EAAE,iBAAEC,OAAF,EAAe;AACvB,YAAA,MAAI,CAACC,QAAL,CAAe;AAAEZ,cAAAA,QAAQ,EAAE;AAAZ,aAAf;;AACAI,YAAAA,gBAAgB,CAACS,iBAAjB,CAAoCF,OAApC;AACA;AANW,SAAF,CAAX;AASArC,QAAAA,aAAa,CAAE+B,IAAF,CAAb;AACA;AACD;;;uCAEmBS,S,EAAY;AAC/B;AACA,UAAKA,SAAS,CAACC,UAAV,IAAwB,CAAE,KAAKb,KAAL,CAAWa,UAA1C,EAAuD;AACtD,aAAKH,QAAL,CAAe;AAAEX,UAAAA,oBAAoB,EAAE;AAAxB,SAAf;AACA;AACD;;;iCAEaQ,K,EAAQ;AACrB,UAAKA,KAAK,IAAIA,KAAK,CAACO,GAApB,EAA0B;AACzB,aAAKJ,QAAL,CAAe;AAAEZ,UAAAA,QAAQ,EAAE;AAAZ,SAAf;AACA,aAAKE,KAAL,CAAWe,aAAX,CAA0B;AACzBZ,UAAAA,IAAI,EAAEI,KAAK,CAACO,GADa;AAEzBE,UAAAA,QAAQ,EAAET,KAAK,CAACU,KAFS;AAGzBC,UAAAA,YAAY,EAAEX,KAAK,CAACO,GAHK;AAIzBK,UAAAA,EAAE,EAAEZ,KAAK,CAACY;AAJe,SAA1B;AAMA;AACD;;;qCAEgB;AAChB,WAAKT,QAAL,CAAe;AAAEX,QAAAA,oBAAoB,EAAE;AAAxB,OAAf;AACA;;;4CAEuB;AACvB,WAAKW,QAAL,CAAe;AAAEX,QAAAA,oBAAoB,EAAE;AAAxB,OAAf;AACA;;;gDAE4BqB,O,EAAU;AACtC;AACA,WAAKpB,KAAL,CAAWe,aAAX,CAA0B;AAAEG,QAAAA,YAAY,EAAEE;AAAhB,OAA1B;AACA;;;0CAEsBC,Q,EAAW;AACjC,WAAKrB,KAAL,CAAWe,aAAX,CAA0B;AACzBO,QAAAA,cAAc,EAAED,QAAQ,GAAG,QAAH,GAAc;AADb,OAA1B;AAGA;;;6CAEyBA,Q,EAAW;AACpC,WAAKrB,KAAL,CAAWe,aAAX,CAA0B;AAAEQ,QAAAA,kBAAkB,EAAEF;AAAtB,OAA1B;AACA;;;6BAEQ;AAAA,yBASJ,KAAKrB,KATD;AAAA,UAEPwB,SAFO,gBAEPA,SAFO;AAAA,UAGPX,UAHO,gBAGPA,UAHO;AAAA,UAIPZ,UAJO,gBAIPA,UAJO;AAAA,UAKPc,aALO,gBAKPA,aALO;AAAA,UAMPU,QANO,gBAMPA,QANO;AAAA,UAOPvB,gBAPO,gBAOPA,gBAPO;AAAA,UAQPK,KARO,gBAQPA,KARO;AAAA,UAWPS,QAXO,GAkBJf,UAlBI,CAWPe,QAXO;AAAA,UAYPb,IAZO,GAkBJF,UAlBI,CAYPE,IAZO;AAAA,UAaPe,YAbO,GAkBJjB,UAlBI,CAaPiB,YAbO;AAAA,UAcPI,cAdO,GAkBJrB,UAlBI,CAcPqB,cAdO;AAAA,UAePC,kBAfO,GAkBJtB,UAlBI,CAePsB,kBAfO;AAAA,UAgBPG,kBAhBO,GAkBJzB,UAlBI,CAgBPyB,kBAhBO;AAAA,UAiBPP,EAjBO,GAkBJlB,UAlBI,CAiBPkB,EAjBO;AAAA,wBAmBmC,KAAKtB,KAnBxC;AAAA,UAmBAC,QAnBA,eAmBAA,QAnBA;AAAA,UAmBUC,oBAnBV,eAmBUA,oBAnBV;AAoBR,UAAM4B,cAAc,GAAGpB,KAAK,IAAIA,KAAK,CAACqB,IAAtC;;AAEA,UAAK,CAAEzB,IAAF,IAAUL,QAAf,EAA0B;AACzB,eACC,cAAC,gBAAD;AACC,UAAA,IAAI,EAAC,eADN;AAEC,UAAA,MAAM,EAAG;AACRmB,YAAAA,KAAK,EAAE/C,EAAE,CAAE,MAAF,CADD;AAER2D,YAAAA,YAAY,EAAE3D,EAAE,CAAE,mEAAF;AAFR,WAFV;AAMC,UAAA,QAAQ,EAAG,KAAKoB,YANjB;AAOC,UAAA,OAAO,EAAGmC,QAPX;AAQC,UAAA,OAAO,EAAGvB,gBAAgB,CAACS,iBAR5B;AASC,UAAA,MAAM,EAAC;AATR,UADD;AAaA;;AAED,UAAMmB,OAAO,GAAG7D,UAAU,CAAEuD,SAAF,EAAa;AACtC,wBAAgBnD,SAAS,CAAE8B,IAAF;AADa,OAAb,CAA1B;AAIA,aACC,cAAC,QAAD,QACC,cAAC,kBAAD;AACC,QAAA,KAAK,EAAG;AAAEA,UAAAA,IAAI,EAAJA,IAAF;AAAQe,UAAAA,YAAY,EAAZA,YAAR;AAAsBS,UAAAA,cAAc,EAAdA;AAAtB;AADT,SAEM;AACJI,QAAAA,eAAe,EAAE,CAAC,CAAET,cADhB;AAEJC,QAAAA,kBAAkB,EAAlBA,kBAFI;AAGJ7B,QAAAA,2BAA2B,EAAE,KAAKA,2BAH9B;AAIJC,QAAAA,qBAAqB,EAAE,KAAKA,qBAJxB;AAKJC,QAAAA,wBAAwB,EAAE,KAAKA;AAL3B,OAFN,EADD,EAWC,cAAC,aAAD,QACC,cAAC,OAAD,QACC,cAAC,WAAD;AACC,QAAA,QAAQ,EAAG,KAAKN,YADjB;AAEC,QAAA,KAAK,EAAG6B,EAFT;AAGC,QAAA,MAAM,EAAG;AAAA,cAAIa,IAAJ,SAAIA,IAAJ;AAAA,iBACR,cAAC,UAAD;AACC,YAAA,SAAS,EAAC,6BADX;AAEC,YAAA,KAAK,EAAG9D,EAAE,CAAE,WAAF,CAFX;AAGC,YAAA,OAAO,EAAG8D,IAHX;AAIC,YAAA,IAAI,EAAC;AAJN,YADQ;AAAA;AAHV,QADD,CADD,CAXD,EA2BC;AAAK,QAAA,SAAS,EAAGF;AAAjB,SACC;AAAK,QAAA,SAAS,YAAON,SAAP;AAAd,SACC,cAAC,QAAD;AACC,QAAA,gBAAgB,YAAOA,SAAP,eADjB;AAEC,QAAA,OAAO,EAAC,KAFT,CAEe;AAFf;AAGC,QAAA,KAAK,EAAGR,QAHT;AAIC,QAAA,WAAW,EAAG9C,EAAE,CAAE,kBAAF,CAJjB;AAKC,QAAA,sBAAsB,MALvB;AAMC,QAAA,kBAAkB,EAAG,EANtB,CAM2B;AAN3B;AAOC,QAAA,QAAQ,EAAG,kBAAE+D,IAAF;AAAA,iBAAYlB,aAAa,CAAE;AAAEC,YAAAA,QAAQ,EAAEiB;AAAZ,WAAF,CAAzB;AAAA;AAPZ,QADD,EAUGV,kBAAkB,IACnB;AAAK,QAAA,SAAS,YAAOC,SAAP;AAAd,SAEC,cAAC,QAAD;AACC,QAAA,OAAO,EAAC,KADT,CACe;AADf;AAEC,QAAA,SAAS,YAAOA,SAAP,aAFV;AAGC,QAAA,KAAK,EAAGE,kBAHT;AAIC,QAAA,kBAAkB,EAAG,EAJtB,CAI2B;AAJ3B;AAKC,QAAA,WAAW,EAAGxD,EAAE,CAAE,WAAF,CALjB;AAMC,QAAA,sBAAsB,MANvB;AAOC,QAAA,QAAQ,EAAG,kBAAE+D,IAAF;AAAA,iBAAYlB,aAAa,CAAE;AAAEW,YAAAA,kBAAkB,EAAEO;AAAtB,WAAF,CAAzB;AAAA;AAPZ,QAFD,CAXF,CADD,EA0BGpB,UAAU,IACX,cAAC,eAAD;AACC,QAAA,SAAS,MADV;AAEC,QAAA,IAAI,EAAGV,IAFR;AAGC,QAAA,SAAS,YAAOqB,SAAP,sBAHV;AAIC,QAAA,MAAM,EAAG,KAAKhC,cAJf;AAKC,QAAA,YAAY,EAAG,KAAKC;AALrB,SAOGM,oBAAoB,GAAG7B,EAAE,CAAE,SAAF,CAAL,GAAqBA,EAAE,CAAE,UAAF,CAP9C,CA3BF,CA3BD,CADD;AAoEA;;;;EA9LqBS,S;;AAiMvB,eAAeO,OAAO,CAAE,CACvBR,UAAU,CAAE,UAAEwD,MAAF,EAAUlC,KAAV,EAAqB;AAAA,gBACXkC,MAAM,CAAE,MAAF,CADK;AAAA,MACxBC,QADwB,WACxBA,QADwB;;AAAA,MAExBhB,EAFwB,GAEjBnB,KAAK,CAACC,UAFW,CAExBkB,EAFwB;AAGhC,SAAO;AACNZ,IAAAA,KAAK,EAAEY,EAAE,KAAKiB,SAAP,GAAmBA,SAAnB,GAA+BD,QAAQ,CAAEhB,EAAF;AADxC,GAAP;AAGA,CANS,CADa,EAQvB1C,WARuB,CAAF,CAAP,CASVW,QATU,CAAf","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { getBlobByURL, revokeBlobURL, isBlobURL } from '@wordpress/blob';\nimport {\n\tClipboardButton,\n\tIconButton,\n\tToolbar,\n\twithNotices,\n} from '@wordpress/components';\nimport { withSelect } from '@wordpress/data';\nimport { Component, Fragment } from '@wordpress/element';\nimport {\n\tMediaUpload,\n\tMediaPlaceholder,\n\tBlockControls,\n\tRichText,\n\tmediaUpload,\n} from '@wordpress/editor';\nimport { compose } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport FileBlockInspector from './inspector';\n\nclass FileEdit extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.onSelectFile = this.onSelectFile.bind( this );\n\t\tthis.confirmCopyURL = this.confirmCopyURL.bind( this );\n\t\tthis.resetCopyConfirmation = this.resetCopyConfirmation.bind( this );\n\t\tthis.changeLinkDestinationOption = this.changeLinkDestinationOption.bind( this );\n\t\tthis.changeOpenInNewWindow = this.changeOpenInNewWindow.bind( this );\n\t\tthis.changeShowDownloadButton = this.changeShowDownloadButton.bind( this );\n\n\t\tthis.state = {\n\t\t\thasError: false,\n\t\t\tshowCopyConfirmation: false,\n\t\t};\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { attributes, noticeOperations } = this.props;\n\t\tconst { href } = attributes;\n\n\t\t// Upload a file drag-and-dropped into the editor\n\t\tif ( isBlobURL( href ) ) {\n\t\t\tconst file = getBlobByURL( href );\n\n\t\t\tmediaUpload( {\n\t\t\t\tfilesList: [ file ],\n\t\t\t\tonFileChange: ( [ media ] ) => this.onSelectFile( media ),\n\t\t\t\tonError: ( message ) => {\n\t\t\t\t\tthis.setState( { hasError: true } );\n\t\t\t\t\tnoticeOperations.createErrorNotice( message );\n\t\t\t\t},\n\t\t\t} );\n\n\t\t\trevokeBlobURL( href );\n\t\t}\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\t// Reset copy confirmation state when block is deselected\n\t\tif ( prevProps.isSelected && ! this.props.isSelected ) {\n\t\t\tthis.setState( { showCopyConfirmation: false } );\n\t\t}\n\t}\n\n\tonSelectFile( media ) {\n\t\tif ( media && media.url ) {\n\t\t\tthis.setState( { hasError: false } );\n\t\t\tthis.props.setAttributes( {\n\t\t\t\thref: media.url,\n\t\t\t\tfileName: media.title,\n\t\t\t\ttextLinkHref: media.url,\n\t\t\t\tid: media.id,\n\t\t\t} );\n\t\t}\n\t}\n\n\tconfirmCopyURL() {\n\t\tthis.setState( { showCopyConfirmation: true } );\n\t}\n\n\tresetCopyConfirmation() {\n\t\tthis.setState( { showCopyConfirmation: false } );\n\t}\n\n\tchangeLinkDestinationOption( newHref ) {\n\t\t// Choose Media File or Attachment Page (when file is in Media Library)\n\t\tthis.props.setAttributes( { textLinkHref: newHref } );\n\t}\n\n\tchangeOpenInNewWindow( newValue ) {\n\t\tthis.props.setAttributes( {\n\t\t\ttextLinkTarget: newValue ? '_blank' : false,\n\t\t} );\n\t}\n\n\tchangeShowDownloadButton( newValue ) {\n\t\tthis.props.setAttributes( { showDownloadButton: newValue } );\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tclassName,\n\t\t\tisSelected,\n\t\t\tattributes,\n\t\t\tsetAttributes,\n\t\t\tnoticeUI,\n\t\t\tnoticeOperations,\n\t\t\tmedia,\n\t\t} = this.props;\n\t\tconst {\n\t\t\tfileName,\n\t\t\thref,\n\t\t\ttextLinkHref,\n\t\t\ttextLinkTarget,\n\t\t\tshowDownloadButton,\n\t\t\tdownloadButtonText,\n\t\t\tid,\n\t\t} = attributes;\n\t\tconst { hasError, showCopyConfirmation } = this.state;\n\t\tconst attachmentPage = media && media.link;\n\n\t\tif ( ! href || hasError ) {\n\t\t\treturn (\n\t\t\t\t<MediaPlaceholder\n\t\t\t\t\ticon=\"media-default\"\n\t\t\t\t\tlabels={ {\n\t\t\t\t\t\ttitle: __( 'File' ),\n\t\t\t\t\t\tinstructions: __( 'Drag a file, upload a new one or select a file from your library.' ),\n\t\t\t\t\t} }\n\t\t\t\t\tonSelect={ this.onSelectFile }\n\t\t\t\t\tnotices={ noticeUI }\n\t\t\t\t\tonError={ noticeOperations.createErrorNotice }\n\t\t\t\t\taccept=\"*\"\n\t\t\t\t/>\n\t\t\t);\n\t\t}\n\n\t\tconst classes = classnames( className, {\n\t\t\t'is-transient': isBlobURL( href ),\n\t\t} );\n\n\t\treturn (\n\t\t\t<Fragment>\n\t\t\t\t<FileBlockInspector\n\t\t\t\t\threfs={ { href, textLinkHref, attachmentPage } }\n\t\t\t\t\t{ ...{\n\t\t\t\t\t\topenInNewWindow: !! textLinkTarget,\n\t\t\t\t\t\tshowDownloadButton,\n\t\t\t\t\t\tchangeLinkDestinationOption: this.changeLinkDestinationOption,\n\t\t\t\t\t\tchangeOpenInNewWindow: this.changeOpenInNewWindow,\n\t\t\t\t\t\tchangeShowDownloadButton: this.changeShowDownloadButton,\n\t\t\t\t\t} }\n\t\t\t\t/>\n\t\t\t\t<BlockControls>\n\t\t\t\t\t<Toolbar>\n\t\t\t\t\t\t<MediaUpload\n\t\t\t\t\t\t\tonSelect={ this.onSelectFile }\n\t\t\t\t\t\t\tvalue={ id }\n\t\t\t\t\t\t\trender={ ( { open } ) => (\n\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\tclassName=\"components-toolbar__control\"\n\t\t\t\t\t\t\t\t\tlabel={ __( 'Edit file' ) }\n\t\t\t\t\t\t\t\t\tonClick={ open }\n\t\t\t\t\t\t\t\t\ticon=\"edit\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Toolbar>\n\t\t\t\t</BlockControls>\n\t\t\t\t<div className={ classes }>\n\t\t\t\t\t<div className={ `${ className }__content-wrapper` }>\n\t\t\t\t\t\t<RichText\n\t\t\t\t\t\t\twrapperClassName={ `${ className }__textlink` }\n\t\t\t\t\t\t\ttagName=\"div\" // must be block-level or else cursor disappears\n\t\t\t\t\t\t\tvalue={ fileName }\n\t\t\t\t\t\t\tplaceholder={ __( 'Write file name…' ) }\n\t\t\t\t\t\t\tkeepPlaceholderOnFocus\n\t\t\t\t\t\t\tformattingControls={ [] } // disable controls\n\t\t\t\t\t\t\tonChange={ ( text ) => setAttributes( { fileName: text } ) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{ showDownloadButton &&\n\t\t\t\t\t\t\t<div className={ `${ className }__button-richtext-wrapper` }>\n\t\t\t\t\t\t\t\t{ /* Using RichText here instead of PlainText so that it can be styled like a button */ }\n\t\t\t\t\t\t\t\t<RichText\n\t\t\t\t\t\t\t\t\ttagName=\"div\" // must be block-level or else cursor disappears\n\t\t\t\t\t\t\t\t\tclassName={ `${ className }__button` }\n\t\t\t\t\t\t\t\t\tvalue={ downloadButtonText }\n\t\t\t\t\t\t\t\t\tformattingControls={ [] } // disable controls\n\t\t\t\t\t\t\t\t\tplaceholder={ __( 'Add text…' ) }\n\t\t\t\t\t\t\t\t\tkeepPlaceholderOnFocus\n\t\t\t\t\t\t\t\t\tonChange={ ( text ) => setAttributes( { downloadButtonText: text } ) }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t}\n\t\t\t\t\t</div>\n\t\t\t\t\t{ isSelected &&\n\t\t\t\t\t\t<ClipboardButton\n\t\t\t\t\t\t\tisDefault\n\t\t\t\t\t\t\ttext={ href }\n\t\t\t\t\t\t\tclassName={ `${ className }__copy-url-button` }\n\t\t\t\t\t\t\tonCopy={ this.confirmCopyURL }\n\t\t\t\t\t\t\tonFinishCopy={ this.resetCopyConfirmation }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ showCopyConfirmation ? __( 'Copied!' ) : __( 'Copy URL' ) }\n\t\t\t\t\t\t</ClipboardButton>\n\t\t\t\t\t}\n\t\t\t\t</div>\n\t\t\t</Fragment>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select, props ) => {\n\t\tconst { getMedia } = select( 'core' );\n\t\tconst { id } = props.attributes;\n\t\treturn {\n\t\t\tmedia: id === undefined ? undefined : getMedia( id ),\n\t\t};\n\t} ),\n\twithNotices,\n] )( FileEdit );\n"]}